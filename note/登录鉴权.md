- vuex       数据仓库
- vue-router 前置导航守卫
- vue    

#vuex
```js
import Vuex from "vuex";
import Vue from "vue";
import loginUser from "./loginUser";
Vue.use(Vuex);
const store = new Vuex.Store({
  modules: {
    loginUser,
  },
});
window.store = store;
export default store;
```
**loginUser**
```js
import * as userApi from "../api/user";

export default {
  namespaced: true,
  strict: true,
  state: {
    loading: false,
    data: null,
  },
  mutations: {
    setLoading(state, payload) {
      state.loading = payload;
    },
    setData(state, payload) {
      state.data = payload;
    },
  },
  getters: {
    status(state) {
      if (state.loading) {
        return "loading";
      } else if (state.data) {
        return "login";
      } else {
        return "unlogin";
      }
    },
  },
  actions: {
    async whoAmI({ commit }) {
      commit("setLoading", true);
      const resp = await userApi.whoAmI();
      commit("setLoading", false);
      commit("setData", resp);
    },
    async login({ commit }, payload) {
      commit("setLoading", true);
      const resp = await userApi.login(payload.loginId, payload.loginPwd);
      commit("setLoading", false);
      commit("setData", resp);
      return resp;
    },
    async loginOut({ commit }) {
      commit("setLoading", true);
      await userApi.loginOut();
      commit("setLoading", false);
      commit("setData", null);
    },
  },
};
```

#vue-router
配置&前置导航守卫
```js
import VueRouter from "vue-router";
import routes from "./routes";
import Vue from "vue";
import store from "../store";
Vue.use(VueRouter);
const router = new VueRouter({
  routes,
  mode: "history",
});

router.beforeResolve((to, from, next) => {
  console.log(123);
  if (to.meta.auth) {
    const status = store.getters["loginUser/status"];
    if (status === "loading") {
      next({
        path: "/loading",
        query: {
          returnurl: to.fullPath,
        },
      });
      return;
    } else if (status === "unlogin") {
      alert("你没有登录，请先登录");
      next({
        path: "/login",
        query: {
          returnurl: to.fullPath,
        },
      });
      return;
    }
  }
  next();
});
export default router;
```
**routes**
```js
import Home from "../views/Home.vue";
import Login from "../views/Login.vue";
import User from "../views/User.vue";
import Loading from "../views/Loading.vue";
import News from "../views/News.vue";

export default [
  {
    path: "/",
    component: Home,
  },
  { path: "/news", component: News, meta: { auth: true } },
  { path: "/loading", component: Loading },
  { path: "/login", component: Login },
  {
    path: "/user",
    component: User,
    meta: {
      auth: true,
    },
  },
];
```
vue-router
`router.beforeResolve((to, from, next)=>{})`